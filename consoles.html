<!DOCTYPE html>
<html>

  <head>
    <meta charset="utf-8">
    <title>D3js Bar Graph</title>
    <link rel="stylesheet" type="text/css" href="stylesheet.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js" charset="utf-8"></script>
    <script src="//labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>
  </head>

  <body>
    <h1 style="text-align:center;">498DV DRP</h1>
    <script type="text/javascript" src="consoles.js"></script>
	    <button onclick="window.location.href = 'https://danielp6.github.io/manufacturers.html';">Click Here</button>
        <button onlick="javascript: updateData();">Update</button>
  </body>
<script>
  function updateData() {
      console.log("UPDATING");

      d3.csv("VGM-2.csv", function(error, csv_data) {
        var data = d3.nest()
          .key(function(d) {
            return d.Platform;
          })
          .rollup(function(d) {
            return d3.sum(d, function(g) {
              if (g.Year_of_Release == 2008) return g.Global_Sales;
            });
          }).entries(csv_data);

        data.forEach(function(d) {
          d.Platform = d.key;
          d.Global_Sales = d.values;
        })

        var tip = d3.tip()
          .attr('class', 'd3-tip')
          .offset([-10, 0])
          .html(function(d) {
            return "<strong>Sales:</strong> <span style='color:red'>" + (d.Global_Sales).toFixed(2) + "</span>";
          });
        svg.call(tip);

        xScale.domain(["2600","3DS","DC","DS","GB","GBA","GC","GEN","PS2","XB","X360","PS","Wii","PSV","PSP","PS3","N64","NES","PC","PS4","SAT","SNES","WiiU","XOne"]);
        yScale.domain([0, d3.max(data, function(d) {
          return d.Global_Sales;
        })]);

        svg.selectAll(".bar")
          .data(data)
          .enter()
          .append('rect')
          .attr("class", "bar")
          .attr("height", 0)
          .attr("y", height)
          .on('mouseover', tip.show)
          .on('mouseout', tip.hide)
          .transition().duration(2500)
          .delay(function(d, i) {
            return i * 200;
          })
          .attr({
            "x": function(d) {
              return xScale(d.Platform);
            },
            "y": function(d) {
              return yScale(d.Global_Sales);
            },
            "width": xScale.rangeBand(),
            "height": function(d) {
              return height - yScale(d.Global_Sales);
            }
          });


})};
</script>
